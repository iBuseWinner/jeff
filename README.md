# cclc-jeff

Джефф - настраиваемый чат-бот на Qt с поддержкой скриптов.

## Сборка

Генерация Make-файла выполняется командой `$ cmake -S ./ -B /path/of/makefile/dir`.

## Описание

### Встроенный поиск выражений-триггеров

Джефф предоставляет встроенный поиск триггеров в введённых выражениях пользователя. Для ответа на них используются базы данных \*.asw.db, \*.j.db (SQLite).

Чтобы создать базу данных, откройте `Файл > Менеджер источников` или напишите сообщение `/src`. В ответном сообщении нажмите `Добавить контейнер |> Создать`, введите любое название источника, выберите файл для сохранения и нажмите `Сохранить`. Для сохранения изменений нажмите `Сохранить и закрыть`.

Содержимое базы данных включает в себя таблицу `sources` с определёнными свойствами, никнеймом источника (в одной базе данных может быть несколько источников) и его UUID, а также сами таблицы источников.

Источник представляет из себя таблицу с тремя столбцами: 

- адрес выражения
- само выражение
- ссылки от данного выражения на другие
- исполняемый бит (будет добавлен в версии 0.5.0).

Таким образом, использование баз данных может заключаться в подобном примере:

```
1 | Привет!                        | 1,2,3 | 0
2 | Здравствуй!                    | 1,2,3 | 0
3 | handleInScript="greetings.py"; |       | 1
4 | Что такое *\?                  | 5     | 0
5 | handleInScript="wiki.py"       |       | 1
```

Выражения могут ссылаться сами на себя. Выбор между вариантами происходит случайным образом.

Ядро поиска триггеров находится в классе `NLPmodule`. Ядро собирает со всех источников выражения, освобождает от знаков препинания, делает регистронезависимыми, затем ищет их вхождения в пользовательском вводе. Если выражение было найдено, то случайным образом выбирается ответное выражение и добавляется в строку ответа, после чего выводится на экран.

### Скрипты и гибкая система настройки поведения (в версии 0.5.0)

Джефф может обрабатывать выражения при помощи внешних скриптов в нескольких случаях:

1. При запуске программы (startup).
2. При любом вводе пользователя (custom_scan).
3. При необходимости ответить на ввод пользователя (answer).

#### Запуск программы

Выражение должно иметь исполняемый бит и содержать свойство `onStartup` с идентификатором скрипта. Скрипт должен иметь функцию `startup` без аргументов.

#### Ввод пользователя

Выражение должно содержать свойство `handleInScript` и, по необходимости, количество и номера выражений из истории чата в формате `"(автор выражения)(номер выражения в истории, начиная с последнего)"`. Скрипт должен иметь функцию `handle_input` и принимать строку с данными в формате JSON:

```
{ "last1": "Здарова!", "last2": "Привет!" }
```

Сообщения идут в порядке, обратном отправке, и идут под ключами `lastX`, где X - номер сообщения.
